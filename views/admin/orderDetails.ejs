<%- include('../admin-partials/header'); -%>

<div class="page-inner">

    <!-- PAGE MAIN WRAPPER
    ================================================== -->
    <div id="main-wrapper">
        <!-- row -->
        <div class="row g-xl-3">
            
            <div class="col-xl-8 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">Addresses</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-auto me-xl-5 pe-xl-5 mb-4 mb-xl-0">
                                <h6 class="fw-bold text-uppercase mb-3">shipping</h6>
                                <ul class="list-unstyled ps-0">
                                    <li><%=address[0].addreses.addres1%></li>
                                    <li><%=address[0].addreses.addres2%></li>
                                    <li><%=address[0].addreses.city%></li>
                                    <li><%=address[0].addreses.country%></li>
                                    <li><%=address[0].addreses.pincode%></li>
                                    <li><%=address[0].addreses.mobile%></li>
                                </ul>
                          
                            </div>
                                <div class="col-lg-auto ps-xl-5">
                                    <h6 class="fw-bold text-uppercase mb-3">user</h6>
                                  
                                    <strong class="d-block">Email address:</strong>
                                    <a href="#"><%=order.userId.email%></a>
                                    <strong class="d-block mt-3">Phone:</strong>
                                    <a href="#5551234"><%=order.userId.mobile%></a>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">General</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless table-sm mb-0">
                            <tbody>
                                <tr>
                                    <th scope="row">Payment Status:</th>
                                    <td> 
                                        <a href="javasript:void(0)" data-link-action="editmodal" title="Edit Detail" data-bs-toggle="modal" data-bs-target="#edit_modal_1" title="Edit">
                                        <%if(order.payment_status == 'pending'){%>
                                            <span class="badge rounded-pill bg-soft-orange"><%=order.payment_status%></span>
                                        <%}else if(order.payment_status == 'paid'){%>
                                            <span class="badge rounded-pill bg-soft-green"><%=order.payment_status%></span>
                                        <%}else if(order.payment_status == 'cancelled'){%>  
                                            <span class="badge rounded-pill bg-soft-pink"><%=order.payment_status%></span>  
                                        <%}else if(order.payment_status == 'refunded'){%>  
                                            <span class="badge rounded-pill bg-soft-pink"><%=order.payment_status%></span>
                                        <%}%>          
                                        </a>
                                    </td>
                                   
                                </tr>
                                <tr>
                                    <th scope="row">Order Status :</th>
                                    <td>
                                        <%if(order.orderStatus == 'cancelled'){%>
                                            <span class="badge rounded-pill bg-soft-pink"><%=order.orderStatus%></span>
                                        <%}else{%>
                                            <a href="javasript:void(0)" data-link-action="editmodal" title="Edit Detail" data-bs-toggle="modal" data-bs-target="#edit_modal_2" title="Edit">
                                                <%if(order.orderStatus == 'pending'){%>
                                                    <span class="badge rounded-pill bg-soft-orange"><%=order.orderStatus%></span>
                                                <%}else if(order.orderStatus == 'confirmed'){%>
                                                    <span class="badge rounded-pill bg-info"><%=order.orderStatus%></span>
                                                <%}else if(order.orderStatus == 'delivered'){%>  
                                                    <span class="badge rounded-pill bg-soft-green"><%=order.orderStatus%></span>  
                                                <%}else if(order.orderStatus == 'cancelled'){%>  
                                                    <span class="badge rounded-pill bg-soft-pink"><%=order.orderStatus%></span>
                                                <%}%> 
                                            </a>
                                        <%}%>        
                                       
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">Dashboard :</th>
                                    <td>
                                        <a href="/admin"><span class="badge rounded-pill bg-soft-green"> DASHBOARD</span></a>
                                    </td>
                                </tr>
                          
                
                            
                            </tbody>
                        </table>
                        <form class="needs-validation" novalidate>
                            <div class="row">
                                
                               
                            </div>
                        </form>

                    </div>
                </div>
            </div>


        </div>
        <!-- end row -->

        <!-- row -->
        <div class="row g-xl-3">
            <div class="col-lg-12 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">Products</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table mb-0 order-details-table">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4 id">image</th>
                                        <th class="name">Name</th>
                                        <th class="text-end cost">Cost</th>
                                        <th class="text-end qty">Qty</th>
                                        <th class="text-end total">View</th>
                               

                                    </tr>
                                </thead>
                                <tbody>
                                    <%if(order){%>
                                        <%if(order.products.length >= 1){%>    
                                            <%for(i=0;i<order.products.length;i++){%> 
                                                <tr>
                                                    <td>
                                                        <div class="image">
                                                            <div><img style="width: 100px; height: 90px;" src="/images/uploads/<%=order.products[i].product.image[0]%>"  alt=""></div>
                                                        </div>
                                                    </td>
                                                    <td><a href="#"><%=order.products[i].product.name%></a></td>
                                                    <td class="text-end">$<%=order.products[i].product.price%></td>
                                                    <td class="text-end"><%=order.products[i].quantity%></td>
                                                    <td class="text-end">$<%=order.products[i].price%></td>
                                                </tr>
                                            
                                            <%}%>
                                        <%}else{%>
                                                <div>
                                                    <h3 style="color: red;" class="emp-cart-msg">NO ORDER</h3>
                                                </div>
                                        <%}%> 
                                    <%}else{%>
                                        <div>
                                            <h3 style="color: red;" class="emp-cart-msg">NO ORDER</h3>
                                        </div>
                                    <%}%>  
                                </tbody>
                            </table>
                        </div>
                        <div class="row justify-content-end flex-column flex-lg-row mt-5">
                            <div class="col-auto me-5">
                                <h6 class="fw-bold mb-2">Items Subtotal</h6>
                                <span class="d-flex align-items-center">
                                  
                                    <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                    <b>$<%=order.total%></b>
                                </span>
                            </div>
                            <div class="col-auto me-5">
                                <h6 class="fw-bold mb-2">Shipping</h6>
                                <span class="d-flex align-items-center">
                                    Flat Rate
                                    <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                    <b>$00.00</b>
                                </span>
                            </div>
                            <%if(order.usedCoupon){%>
                                <!-- <div class="col-auto">
                                    <h6 class="fw-bold mb-2">used Coupon</h6>
                                    <span class="d-flex align-items-center justify-content-lg-end">
                                        <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                        <strong><%=order.usedCoupon%></strong>
                                    </span>
                                </div> -->

                                <div class="col-auto">
                                    <h6 class="fw-bold mb-2">Order Total</h6>
                                    <span class="d-flex align-items-center justify-content-lg-end">
                                        <strong>$<%=order.finalPrice%></strong>
                                        <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                    </span>
                                </div>
                            <%}else{%>    
                            <div class="col-auto">
                                <h6 class="fw-bold mb-2">Order Total</h6>
                                <span class="d-flex align-items-center justify-content-lg-end">
                                    <strong>$<%=order.total%></strong>
                                </span>
                            </div>
                            <%}%>



                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end row -->

        <!-- row -->
        <div class="row g-xl-3">
            <div class="col-xl-4 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">Shipping Information</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless mb-0">
                            <tbody>
                                <tr>
                                    <th colspan="2">
                                        <p class="m-0"><%=order.userId.name%></p>
                                    </th>
                                </tr>
                                <tr>
                                    <th scope="row">Address:</th>
                                    <td><%=address[0].addreses.addres1%></td>
                                </tr>
                            
                                <tr>
                                    <th scope="row">Mobile :</th>
                                    <td><%=order.userId.mobile%> </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-xl-4 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">Billing Information</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless table-sm mb-0">
                            <tbody>
                                <%if(order.payment_method == 'COD'){%>
                                    <tr>
                                        <th scope="row">Payment Type:</th>
                                        <td><%=order.payment_method%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Provider :</th>
                                        <td><%=order.userId.name%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Email :</th>
                                        <td><%=order.userId.email%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Order Placed :</th>
                                        <td><%=order.createdAt.toLocaleDateString("en-AU")%></td>
                                    </tr>
                                <%}else{%>
                                    <tr>
                                        <th scope="row">Payment Type:</th>
                                        <td><%=order.payment_method%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Provider :</th>
                                        <td><%=order.userId.name%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Email :</th>
                                        <td><%=order.userId.email%></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Paid Date :</th>
                                        <td><%=order.updatedAt.toLocaleDateString("en-AU")%></td>
                                    </tr>
                                <%}%>        
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-xl-4 grid-margin">
                <div class="card card-white h-100">
                    <div class="card-heading clearfix">
                        <h4 class="card-title">Delivery Info</h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center">
                            <div class="my-2">
                                <i class="fas fa-truck-moving h1 text-muted"></i>
                            </div>
                            <h5><b>UPS Delivery</b></h5>
                            <div class="mt-2 pt-1">
                                <p class="mb-1"><span>Order ID :</span><%=order.orderId%></p>
                                <p class="mb-0"><span>Payment Mode :</span><%=order.payment_method%></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end row -->

    </div>

    <div class="page-footer">
        <p>Copyright &copy; <span class="current-year"></span> Smartshop All rights reserved.</p>
    </div>
</div>




<div class="modal fade" id="edit_modal_1" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="ec-vendor-block-img space-bottom-30">
                        <div class="ec-vendor-upload-detail">
                            <h2 class="text-center pb-5" >Change Payment Status</h2>
                            <form  id="address" class="row g-3">
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">PENDING</label>
                                    <span onclick="paymentStatus('pending')"  class="badge rounded-pill bg-soft-orange">PENDING</span>
                                </div>
                                
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">PAID</label>
                                    <span onclick="paymentStatus('paid')"  class="badge rounded-pill bg-soft-green">PAID</span>
                                </div>
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">REFUNDED</label>
                                    <span  onclick="paymentStatus('refunded')" class="badge rounded-pill bg-soft-pink">REFUNDED</span>
                                </div>
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">CANCELLED</label>
                                    <span onclick="paymentStatus('cancelled')"  class="badge rounded-pill bg-soft-pink">CANCELLED</span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="edit_modal_2" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="ec-vendor-block-img space-bottom-30">
                        <div class="ec-vendor-upload-detail">
                            <h2 class="text-center pb-5" >Change Order Status</h2>
                            <form  id="address" class="row g-3">
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">PENDING</label>
                                    <span onclick="orderStatus('pending')" class="badge rounded-pill bg-soft-orange">PENDING</span>
                                </div>
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">CONFERMED</label>
                                    <span onclick="orderStatus('confirmed')" class="badge rounded-pill bg-info">CONFERMED</span>
                                </div>
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">DELIVERED</label>
                                    <span onclick="orderStatus('delivered')" class="badge rounded-pill bg-soft-green">DELIVERED</span>
                                </div>
                                <div class="col-md-6 space-t-15">
                                    <label class="form-label">CANCELLED</label>
                                    <span onclick="orderStatus('cancelled')" class="badge rounded-pill bg-soft-pink">CANCELLED</span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>





<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
        async function paymentStatus(id){
        Swal.fire({
            title: 'Are you sure?',
            // text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, change it!'
        }).then((result) => {
            if (result.isConfirmed) {
                let result = axios.put(`/paymentStatus?data=${id}&orderId=${'<%=order.orderId%>'}`,{
                }).then((response)=>{
                    if(response.data.update){
                        Swal.fire(
                            'Changed!',
                            'Payment Status has been changed',
                            'success'
                        )
                        .then((response)=>{
                            window.location.reload()
                        })
                    }
                    else{
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'not changed',
                    })
                    }
                })  
            }
        })
        console.log("result haave come to the fround end")
    }

    //for the status changing  order
    async function orderStatus(id){
        Swal.fire({
            title: 'Are you sure?',
            // text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, change it!'
        }).then((result) => {
            if (result.isConfirmed) {
                let result = axios.put(`/orderStatus?data=${id}&orderId=${'<%=order.orderId%>'}`,{
                }).then((response)=>{
                    if(response.data.update){
                        Swal.fire(
                            'Changed!',
                            'Order Status has been changed',
                            'success'
                        )
                        .then((response)=>{
                            window.location.reload()
                        })
                    }
                    else{
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'not changed',
                    })
                    }
                })  
            }
        })
        console.log("result haave come to the fround end")
    }
</script>



<%- include('../admin-partials/footer'); -%>
